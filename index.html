<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Cron by liebig</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Cron</h1>
        <p>Job scheduling for Laravel</p>
        <p class="view"><a href="https://github.com/liebig/cron">View the Project on GitHub <small>liebig/cron</small></a></p>
        <ul>
          <li><a href="https://github.com/liebig/cron/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/liebig/cron/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/liebig/cron">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a name="-cron-" class="anchor" href="#-cron-"><span class="octicon octicon-link"></span></a>
<img src="https://raw.github.com/liebig/cron/master/icon.png" alt="alt text" title="Cron"> Cron <img src="http://stillmaintained.com/liebig/cron.png" alt="project status">
</h1>

<p>Job scheduling for Laravel</p>

<p>Cron can be used for easily performing cron jobs in Laravel. If you want to run jobs from the internet or just from the local computer, Cron can help you. For more information how Cron can simplify your job scheduling, please have a look at the <a href="#raison">raison d'être</a>.</p>

<ul>
<li>Homepage: <a href="https://liebig.github.io/cron/">https://liebig.github.io/cron/</a>
</li>
<li>Github: <a href="https://github.com/liebig/cron/">https://github.com/liebig/cron/</a>
</li>
<li>API: <a href="http://liebig.github.io/cron/docs/api/classes/Liebig.Cron.Cron.html">http://liebig.github.io/cron/docs/api/classes/Liebig.Cron.Cron.html</a>
</li>
</ul>

<hr>

<ul>
<li><a href="#raison">Raison d’être</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#example">Example</a></li>
<li>
<a href="#api">API</a>

<ul>
<li> <a href="#addjob">Add a cron job</a>
</li>
<li> <a href="#removejob">Remove a cron job</a>
</li>
<li> <a href="#enabledisable">Enable / disable a cron job</a>
</li>
<li> <a href="#runjob">Run the cron jobs</a>
</li>
<li> <a href="#enablelarvellogging">Enable / disable Laravel logging</a>
</li>
<li> <a href="#setlogger">Set a Monolog logger</a>
</li>
<li> <a href="#disabledatabaselogging">Disable database logging</a>
</li>
<li> <a href="#logonlyerrorjobstodatabase">Log only error jobs to database</a>
</li>
<li> <a href="#deleteolddatabaseentries">Delete old database entries</a>
</li>
<li> <a href="#preventoverlapping">Prevent overlapping</a>
</li>
<li> <a href="#events">Events</a>
</li>
<li> <a href="#commands">Commands</a>
</li>
<li> <a href="#reset">Reset Cron</a>
</li>
</ul>
</li>
<li><a href="#faq">Frequently Asked Questions</a></li>
<li><a href="#changelog">Changelog</a></li>
</ul>

<hr>

<p><a name="raison"></a></p>

<h2>
<a name="raison-d%C3%AAtre" class="anchor" href="#raison-d%C3%AAtre"><span class="octicon octicon-link"></span></a>Raison d’être</h2>

<h3>
<a name="simplicity" class="anchor" href="#simplicity"><span class="octicon octicon-link"></span></a>Simplicity</h3>

<p>The aim is to create a simple way to define cron jobs with Laravel. Creating cron jobs with Cron is easy because this tool provides you with a lot of events that you can use to manage all your jobs. For creating a job you only need a job name, a cron expression and a function which will be called as soon as the time has come. Of course PHP is only running if you call it, so you need something in addition which starts Cron. </p>

<h3>
<a name="accessibility" class="anchor" href="#accessibility"><span class="octicon octicon-link"></span></a>Accessibility</h3>

<p>The Cron starting call can be executed from the same machine where your Laravel is located (for example with crontab) or from everywhere on the internet (for example from a web cron service) - it is just a command execution or route call.</p>

<h3>
<a name="centralization" class="anchor" href="#centralization"><span class="octicon octicon-link"></span></a>Centralization</h3>

<p>The Cron management is centralized at a single point in your application. You define all jobs in PHP and don't have to use other tools. Deactivating or removing a Cron job is only a PHP function call away.</p>

<h3>
<a name="platform-independency" class="anchor" href="#platform-independency"><span class="octicon octicon-link"></span></a>Platform independency</h3>

<p>Laravel is a great way to build small and big web applications. But not every application platform runs on a server which allows unix shell access. For these applications Cron provides the possibility to use an external web cron service to start Cron. If you have shell access - great, you can make use of Cron's command to start the job management.</p>

<h3>
<a name="monitoring" class="anchor" href="#monitoring"><span class="octicon octicon-link"></span></a>Monitoring</h3>

<p>If something went wrong with your jobs, Cron will inform you. Next to the logging to Monolog, to the Laravel logging facility and to the database, you can add an event listener to get information about error jobs or successfully executed jobs. After execution you will receive a detailed report about the Cron run. With the power of PHP and events you can send a mail, a notification or anything else if anything happens. Cron is talkative like your grandma.</p>

<h3>
<a name="my-personal-comfort-zone" class="anchor" href="#my-personal-comfort-zone"><span class="octicon octicon-link"></span></a>My personal comfort zone</h3>

<p>At last, Cron is my personal way to manage job scheduling. I am a web application developer, not an infrastructure guy. I like to handle things in PHP and not in the shell. I want to deploy my application to another server without worrying if I have access to crontab or other Linux tools. I really like Laravels event functionality but don't like Laravel commands. Cron management should be easy and powerful at the same time. And finally, I love to handle things at a single place in my application without using the shell or write a PHP file for each job. Cron is the try to manage cron jobs without headaches.</p>

<hr>

<p><a name="installation"></a></p>

<h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<ol>
<li> Add <code>"liebig/cron": "dev-master"</code> to your <code>/path/to/laravel/composer.json</code> file at the <code>"require":</code> section (Find more about composer at <a href="http://getcomposer.org/">http://getcomposer.org/</a>)</li>
<li> Run the <code>composer update liebig/cron --no-dev</code> command in your shell from your <code>/path/to/laravel/</code> directory </li>
<li> Add <code>'Liebig\Cron\CronServiceProvider'</code> to your <code>'providers'</code> array in the <code>/path/to/laravel/app/config/app.php</code> file</li>
<li> Migrate the database with running the command <code>php artisan migrate --package="liebig/cron"</code>
</li>
<li> Publish the configuration file with running the command <code>php artisan config:publish liebig/cron</code> - now you find the Cron configuration file at <code>/path/to/laravel/app/config/packages/liebig/cron</code> and this file won't be overwritten at any update</li>
<li> Now you can use <code>Cron</code> everywhere for free</li>
</ol>

<hr>

<p><a name="configuration"></a></p>

<h2>
<a name="configuration" class="anchor" href="#configuration"><span class="octicon octicon-link"></span></a>Configuration</h2>

<p>Cron is designed to work out of the box without the need of configuration. To enable this a few default values are set. To change Cron's default settings there are two possibilities.</p>

<h3>
<a name="set-methods" class="anchor" href="#set-methods"><span class="octicon octicon-link"></span></a>Set methods</h3>

<p>You can use the Cron set methods (e.g. <code>setDatabaseLogging</code>, <code>setRunInterval</code>) to change Cron's behaviour. This changes are temporary and the set methods have to be called every time.</p>

<h3>
<a name="config-file" class="anchor" href="#config-file"><span class="octicon octicon-link"></span></a>Config file</h3>

<p>The behaviour values will be loaded from a config file. You can change this values easily by editing the <code>/path/to/laravel/app/config/packages/liebig/cron/config.php</code> file. This is the more permanent way. If you only want to change settings for one run with conditions, we recommend to use the setter methods.</p>

<p><strong>NOTE</strong>: All values set via method will overwrite the values loaded from config file.</p>

<hr>

<p><a name="example"></a></p>

<h2>
<a name="example" class="anchor" href="#example"><span class="octicon octicon-link"></span></a>Example</h2>

<h3>
<a name="cron" class="anchor" href="#cron"><span class="octicon octicon-link"></span></a>Cron</h3>

<p>If you use Cron's integrated route or command, you only need to listen for the <code>cron.collectJobs</code> event. The best place to do this is the <code>/path/to/laravel/app/start/global.php</code> file. If you have a development environment configured in your <code>/path/to/laravel/bootstrap/start.php</code> file, you may create a <code>/path/to/laravel/app/start/development.php</code> file and add the job definitions there.</p>

<div class="highlight highlight-php"><pre><span class="nx">Event</span><span class="o">::</span><span class="na">listen</span><span class="p">(</span><span class="s1">'cron.collectJobs'</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">Cron</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">'example1'</span><span class="p">,</span> <span class="s1">'* * * * *'</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="c1">// Do some crazy things unsuccessfully every minute</span>
                    <span class="k">return</span> <span class="s1">'No'</span><span class="p">;</span>
                <span class="p">});</span>

    <span class="nx">Cron</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">'example2'</span><span class="p">,</span> <span class="s1">'*/2 * * * *'</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Do some crazy things successfully every two minute</span>
        <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="nx">Cron</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">'disabled job'</span><span class="p">,</span> <span class="s1">'0 * * * *'</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Do some crazy things successfully every hour</span>
    <span class="p">},</span> <span class="k">false</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>Inside the anonymous function you can use all the Laravel and Cron functions. In the next step you have to configure the route or command which will start Cron.</p>

<h3>
<a name="using-crons-integrated-route" class="anchor" href="#using-crons-integrated-route"><span class="octicon octicon-link"></span></a>Using Cron's integrated route</h3>

<p>If you don't have shell access to your server, you can easily use an online cronjob service (Google knows some good provider). This provider will run Cron's route in a defined interval. The Cron route has to be protected because if someone else than the service provider invokes it, our jobs will be executed too often. For that reason we need a security key in addition to the route path. This key can be generated with the <code>php artisan cron:keygen</code> command call and has to be set in the Cron config file at the key <code>cronKey</code>.</p>

<div class="highlight highlight-php"><pre>    <span class="c1">// Cron application key for securing the integrated Cron run route - if the value is empty, the route is disabled </span>
    <span class="s1">'cronKey'</span> <span class="o">=&gt;</span> <span class="s1">'1PBgabAXdoLTy3JDyi0xRpTR2qNrkkQy'</span>
</pre></div>

<p>Now you have to configure the address and run interval at your online cronjob service provider. The address for the integrated Cron route is always <code>http://yourdomain.com/cron.php?key=securitykey</code>. For the above example this address could be <code>http://exampledomain.com/cron.php?key=1PBgabAXdoLTy3JDyi0xRpTR2qNrkkQy</code> and the run interval has to be every minute (due to the job with the name "example1"). Now the jobs were added, the route key was generated and the service provider was configured.</p>

<h3>
<a name="using-crons-integrated-command" class="anchor" href="#using-crons-integrated-command"><span class="octicon octicon-link"></span></a>Using Cron's integrated command</h3>

<p>If your hosting provider grants you shell access or you can manage cron jobs with a control panel software (e.g. cPanel or Plesk), the best way to run Cron is to use the integrated <code>artisan cron:run</code> command. For the above example the crontab or control panel software command could be <code>* * * * * /usr/bin/php /var/www/laravel/artisan cron:run</code>.</p>

<p><strong>NOTE:</strong> If you want to use Cron's in time check, which will test if the time between two Cron run method calls are correct, please configure the key <code>runInterval</code>. In our example we call the route every minute so the value should be <code>1</code>.</p>

<hr>

<p><a name="api"></a></p>

<h2>
<a name="api" class="anchor" href="#api"><span class="octicon octicon-link"></span></a>API</h2>

<p><a name="addjob"></a></p>

<h3>
<a name="add-a-cron-job" class="anchor" href="#add-a-cron-job"><span class="octicon octicon-link"></span></a>Add a cron job</h3>

<p>Adding a cron job to Cron is very easy by using the static <strong>add</strong> function. As parameter the <strong>name</strong> of the cron job, the cron <strong>expression</strong> and an anonymous <strong>function</strong> is needed. The boolean <strong>isEnabled</strong> is optional and can enable or disable this cron job from execution (default is enabled).</p>

<div class="highlight highlight-php"><pre><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">add</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$expression</span><span class="p">,</span> <span class="nv">$function</span><span class="p">,</span> <span class="nv">$isEnabled</span> <span class="o">=</span> <span class="k">true</span><span class="p">)</span> <span class="p">{</span>
</pre></div>

<p>The <strong>name</strong> is needed for identifying a cron job if an error appears and for logging.</p>

<p>The <strong>expression</strong> is a string of five or optional six subexpressions that describe details of the schedule. The syntax is based on the Linux cron daemon definition.</p>

<pre><code>    *    *    *    *    *    *
    -    -    -    -    -    -
    |    |    |    |    |    |
    |    |    |    |    |    + year [optional]
    |    |    |    |    +----- day of week (0 - 7) (Sunday=0 or 7)
    |    |    |    +---------- month (1 - 12)
    |    |    +--------------- day of month (1 - 31)
    |    +-------------------- hour (0 - 23)
    +------------------------- min (0 - 59)
</code></pre>

<p>The given anonymous <strong>function</strong> will be invoked if the expression details match with the current timestamp. This function should return null in the case of success or anything else if there was an error while executing this job. By default, the error case will be logged to the database and to a Monolog logger object (if logger is enabled). </p>

<p>The <strong>isEnabled</strong> boolean parameter makes it possible to deactivate a job from execution without removing it completely. Later the job execution can be enabled very easily by giving a true boolean to the method. This parameter is optional and the default value is enabled.</p>

<h4>
<a name="example-1" class="anchor" href="#example-1"><span class="octicon octicon-link"></span></a>Example</h4>

<div class="highlight highlight-php"><pre><span class="nx">Cron</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">'example1'</span><span class="p">,</span> <span class="s1">'* * * * *'</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="c1">// Do some crazy things successfully every minute</span>
                    <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
                <span class="p">});</span>
<span class="nx">Cron</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">'example2'</span><span class="p">,</span> <span class="s1">'*/2 * * * *'</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="c1">// Oh no, this job has errors and runs every two minutes</span>
                    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
                <span class="p">},</span> <span class="k">true</span><span class="p">);</span>
</pre></div>

<hr>

<p><a name="removejob"></a></p>

<h3>
<a name="remove-a-cron-job" class="anchor" href="#remove-a-cron-job"><span class="octicon octicon-link"></span></a>Remove a cron job</h3>

<p>To remove a set cron job on runtime use the <strong>remove</strong> method with the cron job name as string parameter.</p>

<div class="highlight highlight-php"><pre><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">remove</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
</pre></div>

<h4>
<a name="example-2" class="anchor" href="#example-2"><span class="octicon octicon-link"></span></a>Example</h4>

<div class="highlight highlight-php"><pre><span class="nx">Cron</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">'example1'</span><span class="p">,</span> <span class="s1">'* * * * *'</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="c1">// Do some crazy things successfully every minute</span>
                    <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
                <span class="p">});</span>
<span class="nx">Cron</span><span class="o">::</span><span class="na">remove</span><span class="p">(</span><span class="s1">'example1'</span><span class="p">);</span>
</pre></div>

<hr>

<p><a name="enabledisable"></a></p>

<h3>
<a name="enable-or-disable-a-cron-job" class="anchor" href="#enable-or-disable-a-cron-job"><span class="octicon octicon-link"></span></a>Enable or disable a cron job</h3>

<p>After adding an enabled or disabled cron job ($isEnabled boolean parameter of the add method call) you can disable or enable a cron job by name. For this use the <strong>setEnableJob</strong> or <strong>setDisableJob</strong> function.</p>

<div class="highlight highlight-php"><pre><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">setEnableJob</span><span class="p">(</span><span class="nv">$jobname</span><span class="p">,</span> <span class="nv">$enable</span> <span class="o">=</span> <span class="k">true</span><span class="p">)</span> <span class="p">{</span>
</pre></div>

<div class="highlight highlight-php"><pre><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">setDisableJob</span><span class="p">(</span><span class="nv">$jobname</span><span class="p">)</span> <span class="p">{</span>
</pre></div>

<h4>
<a name="example-3" class="anchor" href="#example-3"><span class="octicon octicon-link"></span></a>Example</h4>

<div class="highlight highlight-php"><pre><span class="nx">Cron</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">'example1'</span><span class="p">,</span> <span class="s1">'* * * * *'</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="c1">// Do some crazy things successfully every minute</span>
                    <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
                <span class="p">});</span>
<span class="nx">Cron</span><span class="o">::</span><span class="na">setDisableJob</span><span class="p">(</span><span class="s1">'example1'</span><span class="p">);</span>
<span class="c1">// No jobs will be called</span>
<span class="nv">$report</span> <span class="o">=</span> <span class="nx">Cron</span><span class="o">::</span><span class="na">run</span><span class="p">();</span>
<span class="nx">Cron</span><span class="o">::</span><span class="na">setEnableJob</span><span class="p">(</span><span class="s1">'example1'</span><span class="p">);</span>
<span class="c1">// One job will be called</span>
<span class="nv">$report</span> <span class="o">=</span> <span class="nx">Cron</span><span class="o">::</span><span class="na">run</span><span class="p">();</span>
</pre></div>

<h4>
<a name="getter" class="anchor" href="#getter"><span class="octicon octicon-link"></span></a>Getter</h4>

<p>To receive the enable status boolean of a job, use the static <code>isJobEnabled($jobname)</code> method.</p>

<hr>

<p><a name="runjob"></a></p>

<h3>
<a name="run-the-cron-jobs" class="anchor" href="#run-the-cron-jobs"><span class="octicon octicon-link"></span></a>Run the cron jobs</h3>

<p>Running the cron jobs is as easy as adding them. Just call the static <strong>run</strong> method and wait until each added cron job expression is checked. As soon as the time of the expression has come, the corresponding cron job will be invoked. That is the Cron magic. The <strong>run</strong> method returns a detailed report. By default Cron reckons that you call this method every minute (* * * * *) and by default the report (with their cron jobs errors) will be logged to database. You can change this interval using the <code>setRunInterval</code> function.</p>

<div class="highlight highlight-php"><pre><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>
</pre></div>

<h4>
<a name="example-4" class="anchor" href="#example-4"><span class="octicon octicon-link"></span></a>Example</h4>

<div class="highlight highlight-php"><pre><span class="nv">$report</span> <span class="o">=</span> <span class="nx">Cron</span><span class="o">::</span><span class="na">run</span><span class="p">();</span>
</pre></div>

<p><strong>NOTE</strong>: The <strong>run</strong> method call has to be the last function call after adding jobs, setting the interval, deactivating database logging and the other function calls.</p>

<hr>

<h3>
<a name="set-the-run-interval" class="anchor" href="#set-the-run-interval"><span class="octicon octicon-link"></span></a>Set the run interval</h3>

<p>The run interval is the time between two cron job route calls. Some cron service provider only supports calls every 15 or even 30 minutes. In this case you have to set this value to 15 or 30. This value is only important to determine if the current run call is in time. If you have disabled database logging in general, you don't have to care about this.</p>

<div class="highlight highlight-php"><pre><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">setRunInterval</span><span class="p">(</span><span class="nv">$minutes</span><span class="p">)</span> <span class="p">{</span>
</pre></div>

<p><strong>NOTE</strong>: If the route call interval is not every minute you have to adjust your cron job expressions to fit to this interval.</p>

<h4>
<a name="example-5" class="anchor" href="#example-5"><span class="octicon octicon-link"></span></a>Example</h4>

<div class="highlight highlight-php"><pre><span class="c1">// Set the run intervall to 15 minutes</span>
<span class="nx">Cron</span><span class="o">::</span><span class="na">setRunInterval</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
<span class="c1">// Or set the run intervall to 30 minutes</span>
<span class="nx">Cron</span><span class="o">::</span><span class="na">setRunInterval</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
</pre></div>

<h4>
<a name="getter-1" class="anchor" href="#getter-1"><span class="octicon octicon-link"></span></a>Getter</h4>

<p>To recieve the current set run interval use the static <code>getRunInterval()</code> method.</p>

<hr>

<p><a name="enablelarvellogging"></a></p>

<h3>
<a name="enable-or-disable-laravel-logging" class="anchor" href="#enable-or-disable-laravel-logging"><span class="octicon octicon-link"></span></a>Enable or disable Laravel logging</h3>

<p>The Laravel logging facilities provide a layer on top of Monolog. By default, Laravel is configured to create daily log files for your application, and these files are stored in <code>app/storage/logs</code>. Cron will use Laravel logging facilities by default. You can disable this by setting the <code>laravelLogging</code> config.php value to false or call at runtime the <strong>setLaravelLogging</strong> function.</p>

<div class="highlight highlight-php"><pre><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">setLaravelLogging</span><span class="p">(</span><span class="nv">$bool</span><span class="p">)</span> <span class="p">{</span>
</pre></div>

<p><strong>NOTE</strong>: You can add a custom Monolog logger to Cron and enable Laravel logging. In this case all messages will be logged to Laravel and to your custom Monolog logger object.</p>

<h4>
<a name="example-6" class="anchor" href="#example-6"><span class="octicon octicon-link"></span></a>Example</h4>

<div class="highlight highlight-php"><pre><span class="c1">// Laravel logging is enabled by default</span>
<span class="nx">Cron</span><span class="o">::</span><span class="na">run</span><span class="p">();</span>
<span class="c1">// Disable Laravel logging</span>
<span class="nx">Cron</span><span class="o">::</span><span class="na">setLaravelLogging</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
<span class="c1">// Laravel logging is disabled</span>
<span class="nx">Cron</span><span class="o">::</span><span class="na">run</span><span class="p">();</span>
</pre></div>

<h4>
<a name="getter-2" class="anchor" href="#getter-2"><span class="octicon octicon-link"></span></a>Getter</h4>

<p>To recieve the enabled or disabled boolean value use the static <code>isLaravelLogging()</code> method.</p>

<hr>

<p><a name="setlogger"></a></p>

<h3>
<a name="set-a-monolog-logger" class="anchor" href="#set-a-monolog-logger"><span class="octicon octicon-link"></span></a>Set a Monolog logger</h3>

<p>If you want to add a custom Monolog logger object to Cron use the static <strong>setLogger</strong> method.</p>

<div class="highlight highlight-php"><pre><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">setLogger</span><span class="p">(</span><span class="nx">\Monolog\Logger</span> <span class="nv">$logger</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
</pre></div>

<p><strong>NOTE</strong>: If you want to remove the logger, just call the <strong>setLogger</strong> method without parameters.</p>

<h4>
<a name="example-7" class="anchor" href="#example-7"><span class="octicon octicon-link"></span></a>Example</h4>

<div class="highlight highlight-php"><pre><span class="nx">Cron</span><span class="o">::</span><span class="na">setLogger</span><span class="p">(</span><span class="k">new</span> <span class="nx">\Monolog\Logger</span><span class="p">(</span><span class="s1">'cronLogger'</span><span class="p">));</span>
<span class="c1">// And remove the logger again</span>
<span class="nx">Cron</span><span class="o">::</span><span class="na">setLogger</span><span class="p">();</span>
</pre></div>

<h4>
<a name="getter-3" class="anchor" href="#getter-3"><span class="octicon octicon-link"></span></a>Getter</h4>

<p>To recieve the set logger object use the static <code>getLogger()</code> method. If no logger object is set, null will be returned. </p>

<hr>

<p><a name="disabledatabaselogging"></a></p>

<h3>
<a name="disable-database-logging" class="anchor" href="#disable-database-logging"><span class="octicon octicon-link"></span></a>Disable database logging</h3>

<p>By default database logging is enabled and after each cron run a manager object and job objects will be saved to database. We strongly recommend to keep the database logging activated because only with this option Cron can check if the current run is in time. It could make sense in some cases to deactivate the database logging with the <strong>setDatabaseLogging</strong> method.</p>

<div class="highlight highlight-php"><pre><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">setDatabaseLogging</span><span class="p">(</span><span class="nv">$bool</span><span class="p">)</span> <span class="p">{</span>
</pre></div>

<h4>
<a name="example-8" class="anchor" href="#example-8"><span class="octicon octicon-link"></span></a>Example</h4>

<div class="highlight highlight-php"><pre><span class="nx">Cron</span><span class="o">::</span><span class="na">setDatabaseLogging</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
</pre></div>

<h4>
<a name="getter-4" class="anchor" href="#getter-4"><span class="octicon octicon-link"></span></a>Getter</h4>

<p>To receive the current boolean value of the logging to database variable, just use the static <code>isDatabaseLogging()</code> function.</p>

<hr>

<p><a name="logonlyerrorjobstodatabase"></a></p>

<h3>
<a name="log-only-error-jobs-to-database" class="anchor" href="#log-only-error-jobs-to-database"><span class="octicon octicon-link"></span></a>Log only error jobs to database</h3>

<p>By default Cron will log all jobs to database. Maybe sometimes you want to log only error jobs (which not return null) to database by using the static <strong>setLogOnlyErrorJobsToDatabase</strong> function. </p>

<div class="highlight highlight-php"><pre><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">setLogOnlyErrorJobsToDatabase</span><span class="p">(</span><span class="nv">$bool</span><span class="p">)</span> <span class="p">{</span>
</pre></div>

<h4>
<a name="example-9" class="anchor" href="#example-9"><span class="octicon octicon-link"></span></a>Example</h4>

<div class="highlight highlight-php"><pre><span class="c1">// Log only error jobs to database</span>
<span class="nx">Cron</span><span class="o">::</span><span class="na">setLogOnlyErrorJobsToDatabase</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
</pre></div>

<h4>
<a name="getter-5" class="anchor" href="#getter-5"><span class="octicon octicon-link"></span></a>Getter</h4>

<p>To receive the current boolean value of the error job logging, use the static <code>isLogOnlyErrorJobsToDatabase()</code> function.</p>

<hr>

<p><a name="deleteolddatabaseentries"></a></p>

<h3>
<a name="delete-old-database-entries" class="anchor" href="#delete-old-database-entries"><span class="octicon octicon-link"></span></a>Delete old database entries</h3>

<p>Cron can delete old database entries for you. During each run method call, Cron checks if there are old manager and job entries in the database and if the reference value is reached, the entries will be deleted. You can change the reference value by calling the <strong>setDeleteDatabaseEntriesAfter</strong> function. The default value is 240 hours (10 days). To disable the deletion of old entries just set the reference value to 0.</p>

<div class="highlight highlight-php"><pre><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">setDeleteDatabaseEntriesAfter</span><span class="p">(</span><span class="nv">$hours</span><span class="p">)</span> <span class="p">{</span>
</pre></div>

<h4>
<a name="example-10" class="anchor" href="#example-10"><span class="octicon octicon-link"></span></a>Example</h4>

<div class="highlight highlight-php"><pre><span class="c1">// Set the delete database entries reference value to 10 days (24 hours x 10 days)</span>
<span class="nx">Cron</span><span class="o">::</span><span class="na">setDeleteDatabaseEntriesAfter</span><span class="p">(</span><span class="mi">240</span><span class="p">);</span>
</pre></div>

<h4>
<a name="getter-6" class="anchor" href="#getter-6"><span class="octicon octicon-link"></span></a>Getter</h4>

<p>To receive the current reference value just use the static <code>getDeleteDatabaseEntriesAfter</code> function.</p>

<hr>

<p><a name="preventoverlapping"></a></p>

<h3>
<a name="prevent-overlapping" class="anchor" href="#prevent-overlapping"><span class="octicon octicon-link"></span></a>Prevent overlapping</h3>

<p>Cron can prevent overlapping. If this is enabled, only one Cron instance can run at the same time. For example if some jobs need 5 minutes for execution but the Cron route will be called every minute, without preventing overlapping two Cron instances will execute jobs at the same time. When running a job twice at the same time, side effects can occur. Cron can avoid such overlaps by using simple locking techniques.</p>

<div class="highlight highlight-php"><pre><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">setEnablePreventOverlapping</span><span class="p">()</span> <span class="p">{</span>
</pre></div>

<h4>
<a name="example-11" class="anchor" href="#example-11"><span class="octicon octicon-link"></span></a>Example</h4>

<div class="highlight highlight-php"><pre><span class="c1">// The configuration could be set via config.php file with the key 'preventOverlapping' or via method</span>
<span class="nx">Cron</span><span class="o">::</span><span class="na">setEnablePreventOverlapping</span><span class="p">();</span>
<span class="c1">// Now the Cron run will only run once at the same time</span>

<span class="nx">Cron</span><span class="o">::</span><span class="na">setDisablePreventOverlapping</span><span class="p">();</span>
<span class="c1">// Prevent overlapping is disabled and many Cron run executions are possible at the same time</span>
</pre></div>

<h4>
<a name="getter-7" class="anchor" href="#getter-7"><span class="octicon octicon-link"></span></a>Getter</h4>

<p>To receive the current boolean value just use the static <code>isPreventOverlapping</code> function.</p>

<p><strong>NOTE</strong>: To use the overlapping function, Cron needs writing access to the Laravel storage directory. On some Windows machines the lock file cannot be deleted. If you see a delete error message in your log, please disable this feature.</p>

<hr>

<p><a name="events"></a></p>

<h3>
<a name="events" class="anchor" href="#events"><span class="octicon octicon-link"></span></a>Events</h3>

<p>Cron supports Laravel events and provides many information about the run status and the job status. With this you can react to errors. Cron supports the following events.</p>

<ul>
<li>
<code>cron.collectJobs</code> - fired before run method call to add jobs and to configure Cron. This event is only fired if you use Cron's integrated route or command.</li>
<li>
<code>cron.beforeRun</code> - fired before run method call to inform that Cron is about to start. Parameter: <code>$runDate</code>.</li>
<li>
<code>cron.jobError</code> - fired after a job was exectued and this job returned an error (return value is not equal null). Parameter: <code>$name</code>, <code>$return</code>, <code>$runtime</code>, <code>$rundate</code>.</li>
<li>
<code>cron.jobSuccess</code> - fired after a job was executed and this job did not return an error (return value is equal null). Parameter: <code>$name</code>, <code>$runtime</code>, <code>$rundate</code>.</li>
<li>
<code>cron.afterRun</code> - fired after the Cron run was finished. Parameter: <code>$rundate</code>, <code>$inTime</code>, <code>$runtime</code>, <code>$errors</code> - number of error jobs, <code>$crons</code> - array of all exectued jobs (with the keys <code>$name</code>, <code>$return</code>, <code>$runtime</code>), <code>$lastRun</code> - array with information of the last Cron run (with the keys <code>$rundate</code> and <code>$runtime</code>). The <code>$lastRun</code> parameter is an empty array, if Cron is called the first time or if database logging is disabled and therefore the <code>$inTime</code> parameter is equals <code>-1</code>.</li>
</ul>

<p>To subscribe to an event, use Laravels <code>Event</code> facility. The best place for this is the <code>/path/to/laravel/app/start/global.php</code> file.</p>

<div class="highlight highlight-php"><pre><span class="nx">Event</span><span class="o">::</span><span class="na">listen</span><span class="p">(</span><span class="s1">'cron.jobError'</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$return</span><span class="p">,</span> <span class="nv">$runtime</span><span class="p">,</span> <span class="nv">$rundate</span><span class="p">){</span>
    <span class="nx">Log</span><span class="o">::</span><span class="na">error</span><span class="p">(</span><span class="s1">'Job with the name '</span> <span class="o">.</span> <span class="nv">$name</span> <span class="o">.</span> <span class="s1">' returned an error.'</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<hr>

<p><a name="commands"></a></p>

<h3>
<a name="commands" class="anchor" href="#commands"><span class="octicon octicon-link"></span></a>Commands</h3>

<p>Cron brings you the following Laravel commands.</p>

<ul>
<li>
<code>cron:run</code> - fires the <code>cron.collectJobs</code> event and starts Cron.</li>
<li>
<code>cron:list</code> - fires the <code>cron.collectJobs</code> event and lists all registered Cron jobs.</li>
<li>
<code>cron:keygen</code> - generates a security token with 32 characters.</li>
</ul>

<hr>

<p><a name="reset"></a></p>

<h3>
<a name="reset-cron" class="anchor" href="#reset-cron"><span class="octicon octicon-link"></span></a>Reset Cron</h3>

<p>To reset the cron management, call the static <strong>reset</strong> method. It will reset all variables to the default values.</p>

<div class="highlight highlight-php"><pre><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">reset</span><span class="p">()</span> <span class="p">{</span>
</pre></div>

<h4>
<a name="example-12" class="anchor" href="#example-12"><span class="octicon octicon-link"></span></a>Example</h4>

<div class="highlight highlight-php"><pre><span class="nx">Cron</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">'example1'</span><span class="p">,</span> <span class="s1">'* * * * *'</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="c1">// Do some crazy things successfully every minute</span>
                    <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
                <span class="p">});</span>
<span class="nx">Cron</span><span class="o">::</span><span class="na">setLogger</span><span class="p">(</span><span class="k">new</span> <span class="nx">\Monolog\Logger</span><span class="p">(</span><span class="s1">'cronLogger'</span><span class="p">));</span>
<span class="nx">Cron</span><span class="o">::</span><span class="na">reset</span><span class="p">();</span>
<span class="c1">// Cron::remove('example1') === false</span>
<span class="c1">// Cron::getLogger() === NULL</span>
</pre></div>

<hr>

<p><a name="faq"></a></p>

<h2>
<a name="frequently-asked-questions" class="anchor" href="#frequently-asked-questions"><span class="octicon octicon-link"></span></a>Frequently Asked Questions</h2>

<h3>
<a name="do-i-really-need-crontab-or-an-online-cronjob-service" class="anchor" href="#do-i-really-need-crontab-or-an-online-cronjob-service"><span class="octicon octicon-link"></span></a>Do I really need crontab or an online cronjob service</h3>

<p>Yes, you do. In comparison to a Java application server for example, PHP only runs if it is executed. If crontab or an online cronjob service provider calls PHP and starts the application, Cron can execute the jobs and will start the work. If PHP is not started, the application sleeps and nothing happens. </p>

<h3>
<a name="what-is-the-best-interval-to-call-the-route-or-command" class="anchor" href="#what-is-the-best-interval-to-call-the-route-or-command"><span class="octicon octicon-link"></span></a>What is the best interval to call the route or command?</h3>

<p>The best interval depends on your jobs. If one job should be executed every minute and another every five minutes, the route or command has to be called every minute. In general you have to find the greatest common divisor of your jobs. Please don't forget to change the <code>runInterval</code> config value if the route or command is not called every minute (default value) and if you want to use Cron's in time check.</p>

<h3>
<a name="cron-is-not-running-properly-and-returns-runtime-and-intime-with-value--1" class="anchor" href="#cron-is-not-running-properly-and-returns-runtime-and-intime-with-value--1"><span class="octicon octicon-link"></span></a>Cron is not running properly and returns <code>runtime</code> and <code>inTime</code> with value <code>-1</code>
</h3>

<p>By default Cron prevents overlapping. This means that only one Cron instance will run at the same time. If another instance is called, Cron will not run and will return the runtime and inTime parameter with the value -1. On some Windows machines the deletion of the lock file fails and you have to disable this feature. Please have a look at the <a href="#preventoverlapping">prevent overlapping section</a>.</p>

<hr>

<p><a name="changelog"></a></p>

<h2>
<a name="changelog" class="anchor" href="#changelog"><span class="octicon octicon-link"></span></a>Changelog</h2>

<h3>
<a id="20150202---102" class="anchor" href="#20150202---102" aria-hidden="true"><span class="octicon octicon-link"></span></a>2015/02/02 - 1.0.2</h3>

<ul>
<li>Adding cron.locked event</li>
<li>Marking Cron as stable</li>
<li>Changing $function parameter type to "callable" to fix IDE type hints</li>
</ul>

<h3>
<a name="20141013---101" class="anchor" href="#20141013---101"><span class="octicon octicon-link"></span></a>2014/10/13 - 1.0.1</h3>

<ul>
<li>Adding try-catch-finally block to the run method to always remove the lock file</li>
<li>Adding $lastRun parameter to the cron.afterRun event</li>
<li>Adding Laravel 5 support</li>
<li>Removing return-string truncating after 500 characters</li>
<li>Fixing cron.afterRun event</li>
</ul>

<h3>
<a name="20140612---100" class="anchor" href="#20140612---100"><span class="octicon octicon-link"></span></a>2014/06/12 - 1.0.0</h3>

<ul>
<li>Adding Laravel route with security token</li>
<li>Adding Artisan command for generating security token</li>
<li>Adding Artisan command for running Cron easily with e.g. crontab</li>
<li>Adding Artisan command for list all jobs, added via event</li>
<li>Adding events</li>
<li>Adding overlapping protection</li>
<li>Changing default value for config key 'logOnlyErrorJobsToDatabase' to false</li>
<li>Fixing PHP doc markup</li>
<li>Generating API</li>
<li>Refurbishing this README file</li>
<li>Minor bug fixes</li>
</ul>

<h3>
<a name="20140211---v095" class="anchor" href="#20140211---v095"><span class="octicon octicon-link"></span></a>2014/02/11 - v0.9.5</h3>

<ul>
<li>Bug fixing release</li>
<li>Fixing bug with PSR0 Autoloading</li>
<li>Fixing time bug - if a job took more than one minute for execution the following jobs were not handled</li>
</ul>

<h3>
<a name="20131112---v094" class="anchor" href="#20131112---v094"><span class="octicon octicon-link"></span></a>2013/11/12 - v0.9.4</h3>

<ul>
<li>Adding Laravel logging facilities - by default Cron will log to Laravel now</li>
<li>Adding Exceptions - Cron will throw InvalidArgumentExceptions and UnexpectedValueExceptions now</li>
<li>Minor bug fixes</li>
</ul>

<h3>
<a name="20131101---v093" class="anchor" href="#20131101---v093"><span class="octicon octicon-link"></span></a>2013/11/01 - v0.9.3</h3>

<ul>
<li>Adding facade for Cron - you can use <code>Cron</code> instead of <code>\Liebig\Cron\Cron</code> now</li>
<li>Adding facade test cases</li>
</ul>

<hr>

<h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>

<p>The MIT License (MIT)</p>

<p>Copyright (c) 2014 Marc Liebig</p>

<p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.</p>

<p>Icon Copyright (c) Timothy Miller (<a href="http://www.iconfinder.com/icondetails/171279/48/alarm_bell_clock_time_icon">http://www.iconfinder.com/icondetails/171279/48/alarm_bell_clock_time_icon</a>) under Creative Commons (Attribution-Share Alike 3.0 Unported) License - Thank you for this awesome icon you own</p>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/liebig">liebig</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>